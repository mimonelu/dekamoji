<!doctype html>
<html lang="ja">
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="creator" content="mimonelu">
    <meta name="publisher" content="mimonelu">
    <meta name="description" content="デカ文字">
    <meta name="robots" content="all">
    <meta property="og:title" content="デカ文字">
    <meta property="og:type" content="デカ文字">
    <meta property="og:url" content="https://mimonelu.github.io/dekamoji/?t=デカ文字&b=black&f=white&w=1200&h=630&ff=serif">
    <meta property="og:image" content="https://mimonelu.github.io/dekamoji/ogp.png">
    <meta property="og:site_name" content="デカ文字">
    <meta property="og:description" content="デカ文字">
    <title>デカ文字</title>
    <style>
*, * > * {
  margin: 0;
  padding: 0;
}
body {
  background-color: #000000;
  color: #ffffff;
  object-fit: cover;
  overflow: hidden;
  height: 100vh;
}
#canvas {
  margin: auto;
  object-fit: contain;
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
}
    </style>
    <link rel="icon" href="./favicon.png">
  </head>
  <body>
    <a id="link" href="javascript: void 0;" download="デカ文字">
      <canvas id="canvas"></canvas>
    </a>
    <script>
const appName = 'デカ文字'

const main = () => {
  const params = new URLSearchParams(document.location.search.substring(1))
  const text = params.get('t') || appName
  const texts = text.split('\\n')
  const bgColor = params.get('b') || '#000000'
  const fgColor = params.get('f') || '#ffffff'
  const width = Number(params.get('w') || '1200')
  const height = Number(params.get('h') || '630')
  const fontFamily = params.get('ff') || 'serif'
  updateBgColor(bgColor)
  const image = renderImage(texts, bgColor, fgColor, width, height, fontFamily)
  updateLink(text, image)
  updateOgp(text, image)
}

const updateBgColor = (bgColor) => {
  document.body.style.backgroundColor = bgColor
}

const renderImage = (texts, bgColor, fgColor, width, height, fontFamily) => {
  const canvas = document.querySelector('#canvas')
  const context = canvas.getContext('2d')
  canvas.width = width
  canvas.height = height

  // Render background
  context.fillStyle = bgColor
  context.fillRect(0, 0, canvas.width, canvas.height)

  // Render Texts
  const x = canvas.width / 2
  const fontSize = canvas.width / (Math.max(...texts.map(text => text.length)) + 1)
  const lineHeight = fontSize + (fontSize * 0.25)
  for (let i = 0; i < texts.length; i ++) {
    const text = texts[i]
    const y = (canvas.height / 2)
      + (i * lineHeight)
      - (((texts.length - 1) * lineHeight) / 2)
    context.font = `bold ${fontSize}px ${fontFamily}`
    context.textAlign = 'center'
    context.textBaseline = 'middle'
    context.fillStyle = fgColor
    context.fillText(text, x, y, canvas.width)
  }

  return canvas.toDataURL('image/png', 1.0)
}

const updateLink = (text, image) => {
  const link = document.querySelector('#link')
  link.setAttribute('download', text)
  link.setAttribute('href', image)
}

const updateOgp = (text, image) => {
  if (text !== appName) {
    document.title = `${appName} - ${text}`
    const ogTitle = document.querySelector('[property="og:title"]')
    ogTitle.setAttribute('content', `${appName} - ${text}`)
    const ogUrl = document.querySelector('[property="og:url"]')
    ogUrl.setAttribute('content', location.href)
    const ogImage = document.querySelector('[property="og:image"]')
    ogImage.setAttribute('content', image)
  }
}

main()
    </script>
  </body>
</html>
